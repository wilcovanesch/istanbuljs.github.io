{"head":{"title":"Using Istanbul With IoT.js","layout":"WithQuickStart","QuickStart":{"title":"Using Istanbul With IoT.js"},"description":"You can also use Istanbul to instrument your IoT.js modules or script files. Since IoT.js is rather minimalistic in design, this willâ€¦"},"body":"<p>You can also use Istanbul to instrument your <a href=\"http://iotjs.net//\">IoT.js</a> modules or script files.\nSince IoT.js is rather minimalistic in design, this will require a little more effort than usual.</p>\n<h2 id=\"gathering-coverage-data\"><a href=\"#gathering-coverage-data\" class=\"phenomic-HeadingAnchor\">#</a>Gathering coverage data</h2>\n<p>First, use <strong>nyc</strong> to transpile the source code you would like to instrument to provide line counters.</p>\n<pre><code class=\"hljs language-shell\">node_modules<span class=\"hljs-regexp\">/.bin/</span>nyc instrument path<span class=\"hljs-regexp\">/to/</span><span class=\"hljs-keyword\">source</span> <span class=\"hljs-regexp\">/path/</span>to<span class=\"hljs-regexp\">/output</span></code></pre>\n<p><em>For example, if you'd like to instrument all the builtin modules, you could specify the <code>src/js</code> directory as input.</em></p>\n<p>Next, back-up the original source files, and replace them with the transpiled sources.\nNow, just build IoT.js as you would normally.</p>\n<p>Before running, you will have to modify your test slightly, so that it will actually output the gathered coverage data.\nThis can be done by adding the following to your test file:</p>\n<pre><code class=\"hljs language-js\">process.on(<span class=\"hljs-string\">'exit'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{ <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'fs'</span>).writeFileSync(<span class=\"hljs-string\">'coverage.data'</span>, Buffer(<span class=\"hljs-built_in\">JSON</span>.stringify(__coverage__))) })</code></pre>\n<p><em>You may want to customize this to put the file in a specific directory.</em></p>\n<p>After this, just run your test with IoT.js, and the coverage data should be written to the file you specified.</p>\n<h2 id=\"creating-reports\"><a href=\"#creating-reports\" class=\"phenomic-HeadingAnchor\">#</a>Creating reports</h2>\n<p>To begin, you should restore the source files you've backed-up previously.\nAfter this is done, you will have to use <strong>nyc</strong> again to create a report.</p>\n<p>The <code>--reporter</code> argument can be used to specify which reporter to use, for example in this case <code>lcov</code>.\nYou will have to specify the directory containing the gathered coverage data files in the <code>--temp-directory</code> argument.</p>\n<pre><code class=\"hljs language-shell\">node_modules<span class=\"hljs-regexp\">/.bin/</span>nyc report --reporter=lcov --temp-directory=<span class=\"hljs-regexp\">/path/</span>to<span class=\"hljs-regexp\">/coverage/</span>data</code></pre>\n<p>After this is done, you should find the created report in the <code>coverage</code> sub-directory in you current directory.</p>\n","__filename":"docs/tutorials/iotjs.md","__url":"/docs/tutorials/iotjs/","__resourceUrl":"/docs/tutorials/iotjs/index.html","__dataUrl":"/docs/tutorials/iotjs/index.html.1185345bd3a02bb6adb6c102f37adc14.json"}